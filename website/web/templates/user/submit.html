{% extends "main.html" %}
{% block title %}Submit a new vulnerability{% endblock %}
{% block content %}

<h1>Submit a new vulnerability</h1>

<div class="row">
    <div class="col">
        <select name="source" id="source">
            <option value="cvelistv5">CVELISTV5</option>
        </select>
        <textarea class="form-control" id="vulnerability" rows="30" name="json_schema" required=""></textarea>
        <button class='btn btn-primary' id='submit'>Submit</button>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {

    document.getElementById("submit").onclick = function(event) {
        var json = document.getElementById("vulnerability").value;
        var source = document.getElementById("source").value;
        data = JSON.stringify({json_data: json, source: source});
        console.log(data);
        fetch("{{ url_for('apiv1.api_vulnerabilities_list') }}", {
          method: "POST",
          headers: {
            'Content-Type': 'application/json',
          },
          body: data
        })
        .then(res => {
          if (!res.ok) {
            res.json().then(json => {
              console.log(json.description);
            });
          } else {
            alert('Object successfully updated.');
          }
        })
        .catch((error) => {
            console.log(error);
        });
        };

    });
</script>
{% endblock %}
