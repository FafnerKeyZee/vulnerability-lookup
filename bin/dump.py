#!/usr/bin/env python3

import argparse
import logging
from typing import Optional

import logging.config
import redis

from vulnerabilitylookup.default import AbstractManager
from vulnerabilitylookup.default import get_config, get_homedir

logging.config.dictConfig(get_config('logging'))

host = get_config('generic', 'storage_db_hostname')
port = get_config('generic', 'storage_db_port')

r = redis.Redis(host=host, port=port, decode_responses=True)

parser = argparse.ArgumentParser(
    description="Dump vulnerability-lookup storage in NDJSON."
)

parser.add_argument(
    "--feed", help="Feed to dump. Default is set to nvd.", default="nvd"
)

args = parser.parse_args()

index = f"index:{args.feed}"


def main():
    for cve in r.smembers(index):
        cve_json = r.get(str(cve))
        print(f'{cve_json}')


if __name__ == '__main__':
    main()
