{% extends "main.html" %}
{% from 'bootstrap5/utils.html' import render_messages %}
{% import 'vulnerability_templates.html' as vuln_templates %}

{% block title %}Search a vulnerability{% endblock %}

{% block content %}

{% if not vulnerability_id %}
<div class="position-absolute top-50 start-50 translate-middle">
{%else%}
<div class="position-relative top-0 start-50 translate-middle-x">
{%endif%}
<form class="row g-3" role="form" method=post action="search" enctype=multipart/form-data>
  <div class="col-auto">
    <input type="text" class="form-control" id="freetext_search" placeholder="What are you looking for?" name="freetext_search">
  </div>
  <div class="col-auto">
    <button type="submit" class="btn btn-primary mb-3">Search</button>
  </div>
</form>
</div>

{{ render_messages(container=True, dismissible=True) }}

{% if source %}
    {% if source ==  'nvd' %}
    {{vuln_templates.nvd_view(source=source, vulnerability_id=vulnerability_id, vulnerability_data=vulnerability_data)}}
    {% elif source ==  'gad' %}
    {{vuln_templates.github_view(source=source, vulnerability_id=vulnerability_id, vulnerability_data=vulnerability_data)}}
    {% elif source ==  'gsd' %}
    {{vuln_templates.gsd_view(source=source, vulnerability_id=vulnerability_id, vulnerability_data=vulnerability_data)}}
    {%elif source %}
    Other source: {{source}}.
    <pre>{{vulnerability_data|tojson(indent=2)}}</pre>
    {% endif %}
{% endif %}

{% if linked_vulns %}
  <h5>Vulnerabilites related to the one you searched</h5>
  {% for source, vulnerabilities in linked_vulns.items() %}
    {% for vulnerability_data in vulnerabilities %}
      {% if source ==  'nvd' %}
      {{vuln_templates.nvd_view(source=source, vulnerability_id=vulnerability_id, vulnerability_data=vulnerability_data)}}
      {% elif source ==  'gad' %}
      {{vuln_templates.github_view(source=source, vulnerability_id=vulnerability_id, vulnerability_data=vulnerability_data)}}
      {% elif source ==  'gsd' %}
      {{vuln_templates.gsd_view(source=source, vulnerability_id=vulnerability_id, vulnerability_data=vulnerability_data)}}
      {%elif source %}
      Other source: {{source}}.
      <pre>{{vulnerability_data|tojson(indent=2)}}</pre>
      {% endif %}
    {% endfor%}
  {% endfor%}
{% endif %}

{% endblock %}
