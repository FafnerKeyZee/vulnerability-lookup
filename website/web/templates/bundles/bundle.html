{% extends "main.html" %}
{% block head %}
{{ super() }}
<script src="{{ url_for('static', filename='js/pretty-print-json.min.js') }}"></script>
<link rel="stylesheet" href="{{ url_for('static', filename='css/pretty-print-json.css') }}" />
{% endblock %}
{% block title %}Bundle{% endblock %}
{% block content %}
<h1>{{ bundle.name }}</h1>
<p>Created on {{ bundle.creation_timestamp | datetimeformat }} and updated on {{ bundle.timestamp | datetimeformat }}.</p>
<h2>Description</h2>
{{ description  | safe }}
<h2>Related vulnerabilities</h2>
<ul class="list-group">
  {% for vuln in bundle.related_vulnerabilities %}
  <li class="list-group-item"><a href="{{ url_for('home_bp.vulnerability_view', vulnerability_id=vuln) }}">{{ vuln }}</a></li>
  {% endfor %}
</ul>
{% if bundle.meta %}
<h2>Meta</h2>
<pre id="jsoncontainer">{{ bundle.meta | tojson(indent=2) }}</pre>
{% endif %}
<h2>Author</h2>
<a href="{{ url_for('user_bp.profile', login=bundle.author.login) }}">{{ bundle.author.name }}</a>
<hr />
{% if current_user.is_authenticated and current_user.is_admin %}
<a class="btn btn-primary" href="{{ url_for('bundle_bp.form', bundle_uuid=bundle.uuid) }}">Edit</a>
<a class="btn btn-danger" href="{{ url_for('bundle_bp.delete_bundle', bundle_uuid=bundle.uuid) }}" onclick="return confirm('You are going to delete this bundle.');">Delete</a>
{% endif %}
<script>
  document.addEventListener("DOMContentLoaded", function() {
    jsonContainer = document.getElementById("jsoncontainer");
    if (jsonContainer) {
      jsonContainer.innerHTML = prettyPrintJson.toHtml(JSON.parse(jsonContainer.innerText));
    }
  });
</script>
{% endblock %}
