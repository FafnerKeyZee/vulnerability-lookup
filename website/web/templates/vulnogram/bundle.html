{% extends "main.html" %}

{% block navigation %}{% endblock %}

{% block content %}
<div class="cve" id="body">
    <div class="stk" id="mainHead">
        <header class="ban pad shd">
            <div class="left">
                <a class="logo leaveEditor" href="/">Vulnerability Lookup</a>
            </div>
            <div class="right">
                <a class="leaveEditor" href="{{ url_for('user_bp.submissions') }}" title="Profile">My submissions</a>
            </div>
        </header>
    </div>

    <div class="stk" id="vgHead">
        <header class="ban pad shd hig">
            <div class="left">
                <button class="fbn sfe vgi-put" id="save">Save</button>
            </div>
            <div class="right">
                <form class="indent out nobr" onsubmit="cveSelectLoad(event);return false;">
                    <input class="txt lbl" id="cveEditable" type="search" name="id" list="editablelist" placeholder="CVE-yyyy-nnnn.." title="Load CVE for editing" required>
                    <datalist id="editablelist"></datalist>
                    <button class="btn vgi-in" type="submit"></button>
                </form>
            </div>
        </header>
    </div>


{% block vulnogram %}{% endblock %}

</div>


<script>
document.addEventListener("DOMContentLoaded", function() {
    document.getElementById("save").onclick = function(event) {

        var data = mainTabGroup.getValue();
        data = textUtil.reduceJSON(data);
        data = JSON.stringify(data);

        fetch("{{ url_for('apiv1.api_vulnerabilities_list') }}", {
          method: "POST",
          headers: {
            'Content-Type': 'application/json',
          },
          body: data
        })
        .then(res => {
          if (!res.ok) {
            res.json().then(json => {
              console.log(json);
              alert(json);
            });
          } else {
            alert('Object successfully saved.');
          }
        })
        .catch((error) => {
            console.log(error);
            alert(error);
        });
        };

    });

    var el = document.querySelectorAll(".leaveEditor");
    for(var i =0; i < el.length; i++) {
        el[i].onclick = function(event) {
            if (!confirm('You are going to leave the editor. Are you sure?')) {
                event.preventDefault();
            }
        }
    }

</script>
{% endblock %}
