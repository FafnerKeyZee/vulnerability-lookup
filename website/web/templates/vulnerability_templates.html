{% from 'bootstrap5/utils.html' import render_icon %}
{% macro collapse_raw(source, vulnerability_id, vulnerability_data) %}
<br /><br />
<div class="btn-group" role="group">
  <a role="button" class="btn btn-primary" data-bs-toggle="collapse" data-bs-target="#collapseJson{{vulnerability_id}}" aria-expanded="false" aria-controls="collapseJson{{vulnerability_id}}">
    JSON {{ render_icon('chevron-down') }}
  </a>
  <div class="btn-group" role="group">
    <button id="btnGroupDropShare" type="button" class="btn btn-primary" data-bs-toggle="dropdown" aria-expanded="false">
      Share {{ render_icon('chevron-down') }}
    </button>
    <ul class="dropdown-menu" aria-labelledby="btnGroupDropShare">
      <li><a class="dropdown-item" href="https://news.ycombinator.com/submitlink?u={{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id, _external=True) }}&t=Vulnerability {{ vulnerability_id }}" target="_blank" title="Share on Hacker News">Hacker News</a></li>
      <li><a class="dropdown-item" href="https://www.linkedin.com/shareArticle?mini=true&url={{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id, _external=True) }}&title=Vulnerability {{ vulnerability_id }}" target="_blank" title="Share on LinkedIn">LinkedIn</a></li>
      <li><a class="dropdown-item" href="https://www.newspipe.org/bookmark/bookmarklet?href={{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id, _external=True) }}&title=Vulnerability {{ vulnerability_id }}" target="_blank" title="Share on Newspipe">Newspipe</a></li>
      <li><a class="dropdown-item" href="https://api.pinboard.in/v1/posts/add?url={{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id, _external=True) }}&description=Vulnerability {{ vulnerability_id }}" target="_blank" title="Share on Pinboard">Pinboard</a></li>
      <li><a class="dropdown-item" href="https://reddit.com/submit?link={{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id, _external=True) }}&title=Vulnerability {{ vulnerability_id }}" target="_blank" title="Share on Reddit">Reddit</a></li>
    </ul>
  </div>
  <a type="button" class="btn btn-primary" title="Copy to clipboard" aria-label="Copy to clipboard" onclick="copyToClipboard('{{vulnerability_id}}')" vuln-id="{{vulnerability_id}}" href="#">To clipboard</a>
  {% if config.user_accounts and source in ["cvelistv5", "circl"]  %}
  <a role="button" class="btn btn-primary" title="Edit the object" aria-label="Edit the vulnerability" href="{{ url_for('user_bp.vulnogram', vulnerability_id=vulnerability_id) }}">Edit</a>
  {% endif %}
  {% if config.user_accounts and source == "circl"  %}
  <a role="button" class="btn btn-danger" id="deleteVulnerability" type="button" href="#">Delete</a>
  {% endif %}
</div>

<div class="collapse" id="collapseJson{{vulnerability_id}}">
  <br />
  <div class="card card-body">
    <pre class="json-container" id="container{{vulnerability_id}}">{{vulnerability_data|tojson(indent=2)}}</pre>
  </div>
</div>
{%- endmacro %}

{% macro cisa_known_exploited_view(data) -%}
<div class="card">
  <div class="card-body">
    <h5 class="card-title">CISA Known exploited vulnerability</h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Data from the <a href="https://www.cisa.gov/known-exploited-vulnerabilities-catalog" rel="noreferrer" target="_blank">Known Exploited Vulnerabilities Catalog</a>
    </h6>
    <p class="card-text">Date added: {{data['dateAdded']}}</p>
    <p class="card-text">Due date: {{data['dueDate']}}</p>
    <p class="card-text">Required action: {{data['requiredAction']}}</p>
    <p class="card-text">Used in ransomware: {{data['knownRansomwareCampaignUse']}}</p>
    {%if data['notes'] %}
    <p class="card-text">Notes: {{data['notes']}}</p>
    {%endif%}
  </div>
</div>
{%- endmacro %}

{% macro nvd_view(source, vulnerability_id, vulnerability_data) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title"><a href="{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}">{{vulnerability_id}}</a></h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://nvd.nist.gov/vuln" rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    <p class="card-text">{{vulnerability_data['cve']['descriptions'][0]['value']}}</p>
    {%if 'cisa_known_exploited' in vulnerability_data['meta']%}
    {{ cisa_known_exploited_view(vulnerability_data['meta']['cisa_known_exploited']) }}
    {%endif%}
    <a href="https://nvd.nist.gov/vuln/detail/{{vulnerability_id}}" class="card-link" rel="noreferrer" target="_blank">Show details on source website</a>
    {{ collapse_raw(source, vulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}

{% macro cvelistv5_view(source, vulnerability_id, vulnerability_data) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title"><a href="{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}">{{vulnerability_id}}</a></h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://github.com/CVEProject/cvelistV5" rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    {%if 'rejectedReasons' in vulnerability_data['containers']['cna']%}
      {%for reason in vulnerability_data['containers']['cna']['rejectedReasons']%}
        <p class="card-text">{{reason['value']}}</p>
      {%endfor%}
      {% if 'replacedBy' in vulnerability_data['containers']['cna']%}
        {% for replaced in  vulnerability_data['containers']['cna']['replacedBy'] %}
        <p class="card-text">
          Replaced by <a href="{{url_for('home_bp.vulnerability_view', vulnerability_id=replaced)}}" class="card-link">{{replaced}}</a>
        </p>
        {%endfor%}
      {%endif%}
    {%else%}
      {% if vulnerability_data['containers']['cna']['title'] %}
        <p class="card-text">{{vulnerability_data['containers']['cna']['title']}}</p>
      {% else %}
        <p class="card-text">{{vulnerability_data['containers']['cna']['descriptions'][0]['value']}}</p>
      {%endif%}
      {%if 'cisa_known_exploited' in vulnerability_data['meta']%}
        {{ cisa_known_exploited_view(vulnerability_data['meta']['cisa_known_exploited']) }}
      {%endif%}
    {%endif%}
    <a href="https://nvd.nist.gov/vuln/detail/{{vulnerability_id}}" class="card-link" rel="noreferrer" target="_blank">Show details on NVD website</a>
    {{ collapse_raw(source, vulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}

{% macro circl_view(source, vulnerability_id, vulnerability_data, current_user) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title"><a href="{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}">{{vulnerability_id}}</a></h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://www.circl.lu" rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    {%if 'rejectedReasons' in vulnerability_data['containers']['cna']%}
      {%for reason in vulnerability_data['containers']['cna']['rejectedReasons']%}
        <p class="card-text">{{reason['value']}}</p>
      {%endfor%}
      {% if 'replacedBy' in vulnerability_data['containers']['cna']%}
        {% for replaced in  vulnerability_data['containers']['cna']['replacedBy'] %}
        <p class="card-text">
          Replaced by <a href="{{url_for('home_bp.vulnerability_view', vulnerability_id=replaced)}}" class="card-link">{{replaced}}</a>
        </p>
        {%endfor%}
      {%endif%}
    {%else%}
      {% if vulnerability_data['containers']['cna']['title'] %}
        <p class="card-text">{{vulnerability_data['containers']['cna']['title']}}</p>
      {% else %}
        <p class="card-text">{{vulnerability_data['containers']['cna']['descriptions'][0]['value']}}</p>
      {%endif%}
      {%if 'cisa_known_exploited' in vulnerability_data['meta']%}
        {{ cisa_known_exploited_view(vulnerability_data['meta']['cisa_known_exploited']) }}
      {%endif%}
    {%endif%}
    {{ collapse_raw(source, vulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}

{% macro github_view(source, vulnerability_id, vulnerability_data) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title"><a href="{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}">{{vulnerability_id}}</a></h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://github.com/advisories" rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    <p class="card-text">{{vulnerability_data['summary']}}</p>
    <p class="card-text">{{vulnerability_data['details']}}</p>
    <a href="https://github.com/advisories/{{vulnerability_id}}" class="card-link" rel="noreferrer" target="_blank">Show details on source website</a>
    {{ collapse_raw(source, vulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}

{% macro ossf_malicious_packages_view(source, vulnerability_id, vulnerability_data) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title"><a href="{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}">{{vulnerability_id}}</a></h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://github.com/ossf/malicious-packages" rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    <p class="card-text">{{vulnerability_data['summary']}}</p>
    <p class="card-text">{{vulnerability_data['details']}}</p>
    {{ collapse_raw(source, vulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}

{% macro csaf_siemens_view(source, vulnerability_id, vulnerability_data) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title"><a href="{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}">{{vulnerability_id}}</a></h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://www.siemens.com/global/en/products/services/cert.html" rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    <p class="card-text">{{vulnerability_data['document']['title']}}</p>
    {% for note in vulnerability_data['document']['notes'] %}
    <p class="card-text">
      {%if 'title' in note%}
        <b>{{note['title']}}</b>:
      {%endif%}
      {{note['text']}}
    </p>
    {% endfor %}
    {{ collapse_raw(source, vulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}

{% macro csaf_certbund_view(source, vulnerability_id, vulnerability_data) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title"><a href="{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}">{{vulnerability_id}}</a></h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://wid.cert-bund.de/portal/wid/start" rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    <p class="card-text">{{vulnerability_data['document']['title']}}</p>
    {% for note in vulnerability_data['document']['notes'] %}
    <p class="card-text">
      {%if 'title' in note%}
        <b>{{note['title']}}</b>:
      {%endif%}
      {{note['text']}}
    </p>
    {% endfor %}
    {{ collapse_raw(source, vulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}

{% macro csaf_redhat_view(source, vulnerability_id, vulnerability_data) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title"><a href="{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}">{{vulnerability_id}}</a></h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://access.redhat.com/security/" rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    <p class="card-text">{{vulnerability_data['document']['title']}}</p>
    {% for note in vulnerability_data['document']['notes'] %}
    <p class="card-text">
      {%if 'title' in note%}
        <b>{{note['title']}}</b>:
      {%endif%}
      {{note['text']}}
    </p>
    {% endfor %}
    {{ collapse_raw(source, vulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}

{% macro csaf_cisa_view(source, vulnerability_id, vulnerability_data) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title"><a href="{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}">{{vulnerability_id}}</a></h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://www.cisa.gov" rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    <p class="card-text">{{vulnerability_data['document']['title']}}</p>
    {% for note in vulnerability_data['document']['notes'] %}
    <p class="card-text">
      {%if 'title' in note%}
        <b>{{note['title']}}</b>:
      {%endif%}
      {{note['text']}}
    </p>
    {% endfor %}
    {{ collapse_raw(source, vulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}

{% macro csaf_cisco_view(source, vulnerability_id, vulnerability_data) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title"><a href="{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}">{{vulnerability_id}}</a></h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://www.cisco.com" rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    <p class="card-text">{{vulnerability_data['document']['title']}}</p>
    {% for note in vulnerability_data['document']['notes'] %}
    <p class="card-text">
      {%if 'title' in note%}
        <b>{{note['title']}}</b>:
      {%endif%}
      {{note['text']}}
    </p>
    {% endfor %}
    {{ collapse_raw(source, vulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}

{% macro csaf_sick_view(source, vulnerability_id, vulnerability_data) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title"><a href="{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}">{{vulnerability_id}}</a></h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://www.sick.com/psirt"  rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    <p class="card-text">{{vulnerability_data['document']['title']}}</p>
    {% for note in vulnerability_data['document']['notes'] %}
    <p class="card-text">
      {%if 'title' in note%}
        <b>{{note['title']}}</b>:
      {%endif%}
      {{note['text']}}
    </p>
    {% endfor %}
    {{ collapse_raw(source, vulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}

{% macro csaf_ox_view(source, vulnerability_id, vulnerability_data) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title"><a href="{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}">{{vulnerability_id}}</a></h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://open-xchange.com" rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    <p class="card-text">{{vulnerability_data['document']['title']}}</p>
    {% for note in vulnerability_data['document']['notes'] %}
    <p class="card-text">
      {%if 'title' in note%}
        <b>{{note['title']}}</b>:
      {%endif%}
      {{note['text']}}
    </p>
    {% endfor %}
    {{ collapse_raw(source, ulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}

{% macro csaf_nozominetworks_view(source, vulnerability_id, vulnerability_data) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title"><a href="{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}">{{vulnerability_id}}</a></h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://security.nozominetworks.com/"  rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    <p class="card-text">{{vulnerability_data['document']['title']}}</p>
    {% for note in vulnerability_data['document']['notes'] %}
    <p class="card-text">
      {%if 'title' in note%}
        <b>{{note['title']}}</b>:
      {%endif%}
      {{note['text']}}
    </p>
    {% endfor %}
    {{ collapse_raw(source, vulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}

{% macro gsd_view(source, vulnerability_id, vulnerability_data) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title"><a href="{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}">{{vulnerability_id}}</a></h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://gsd.id" rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    <p class="card-text">
      {% if 'details' in vulnerability_data['gsd']['osvSchema'] %}
      {{vulnerability_data['gsd']['osvSchema']['details'] }}</p>
      {% else  %}
        {% set namespaces = ['cisa.gov', 'cve.org', 'gitlab.com', 'nvd.nist.gov'] %}
        {% set languages = ['eng'] %}
        {% for namespace in namespaces %}
        {% if vulnerability_data['namespaces'].get(namespace, false)  %}
          {% if 'description' in vulnerability_data['namespaces'][namespace] %}
            {% for item in vulnerability_data['namespaces'][namespace]['description']['description_data'] %}
              {% if item['lang'] in languages %}
                {{ item['value'] }}
              {% endif %}
            {% endfor %}
          {% endif %}
        {% endif %}
        {% endfor %}
      {% endif %}
    </p>
    {{ collapse_raw(source, vulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}

{% macro pysec_view(source, vulnerability_id, vulnerability_data) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title"><a href="{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}">{{vulnerability_id}}</a></h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://github.com/pypa/advisory-database" rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    <p class="card-text">{{vulnerability_data['details']}}</p>
    {{ collapse_raw(source, vulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}

{% macro variot_view(source, vulnerability_id, vulnerability_data) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title"><a href="{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}">{{vulnerability_id}}</a></h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://www.variotdbs.pl/vulns/"  rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    <p class="card-text">{{vulnerability_data['description']['data']}}</p>
    <a href="https://www.variotdbs.pl/vuln/{{vulnerability_id}}" class="card-link"  rel="noreferrer" target="_blank">Show details on source website</a>
    {{ collapse_raw(source, vulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}
