{% macro collapse_raw(vulnerability_id, vulnerability_data) %}
</br>
<button class="btn btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#collapseJson{{vulnerability_id}}" aria-expanded="false" aria-controls="collapseJson{{vulnerability_id}}">
  Show JSON
</button>
<div class="collapse" id="collapseJson{{vulnerability_id}}">
  <div class="card card-body">
    <pre>{{vulnerability_data|tojson(indent=2)}}</pre>
  </div>
</div>
{%- endmacro %}

{% macro cisa_known_exploited_view(data) -%}
<div class="card">
  <div class="card-body">
    <h5 class="card-title">CISA Known exploited vulnerability</h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Data from the <a href="https://www.cisa.gov/known-exploited-vulnerabilities-catalog">Known Exploited Vulnerabilities Catalog</a>
    </h6>
    <p class="card-text">Date added: {{data['dateAdded']}}</p>
    <p class="card-text">Due date: {{data['dueDate']}}</p>
    <p class="card-text">Required action: {{data['requiredAction']}}</p>
    <p class="card-text">Used in ransomware: {{data['knownRansomwareCampaignUse']}}</p>
    {%if data['notes'] %}
    <p class="card-text">Notes: {{data['notes']}}</p>
    {%endif%}
  </div>
</div>
{%- endmacro %}

{% macro nvd_view(source, vulnerability_id, vulnerability_data) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title">{{vulnerability_id}}</h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://nvd.nist.gov/vuln" rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    <p class="card-text">{{vulnerability_data['cve']['descriptions'][0]['value']}}</p>
    {%if 'cisa_known_exploited' in vulnerability_data['meta']%}
    {{ cisa_known_exploited_view(vulnerability_data['meta']['cisa_known_exploited']) }}
    {%endif%}
    <a href="https://nvd.nist.gov/vuln/detail/{{vulnerability_id}}" class="card-link" rel="noreferrer" target="_blank">Show details on source website</a>
    {{ collapse_raw(vulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}

{% macro cvelistv5_view(source, vulnerability_id, vulnerability_data) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title">{{vulnerability_id}}</h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://github.com/CVEProject/cvelistV5" rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    {%if 'rejectedReasons' in vulnerability_data['containers']['cna']%}
      {%for reason in vulnerability_data['containers']['cna']['rejectedReasons']%}
        <p class="card-text">{{reason['value']}}</p>
      {%endfor%}
      {% if 'replacedBy' in vulnerability_data['containers']['cna']%}
        {% for replaced in  vulnerability_data['containers']['cna']['replacedBy'] %}
        <p class="card-text">
          Replaced by <a href="{{url_for('home_bp.vulnerability_view', vulnerability_id=replaced)}}" class="card-link">{{replaced}}</a>
        </p>
        {%endfor%}
      {%endif%}
    {%else%}
      {% if vulnerability_data['containers']['cna']['title'] %}
        <p class="card-text">{{vulnerability_data['containers']['cna']['title']}}</p>
      {% else %}
        <p class="card-text">{{vulnerability_data['containers']['cna']['descriptions'][0]['value']}}</p>
      {%endif%}
      {%if 'cisa_known_exploited' in vulnerability_data['meta']%}
        {{ cisa_known_exploited_view(vulnerability_data['meta']['cisa_known_exploited']) }}
      {%endif%}
    {%endif%}
    <a href="https://nvd.nist.gov/vuln/detail/{{vulnerability_id}}" class="card-link" rel="noreferrer" target="_blank">Show details on NVD website</a>
    {{ collapse_raw(vulnerability_id, vulnerability_data) }}
    {% if config.user_accounts  %}
      <a class="btn btn-primary" type="button" href="{{ url_for('user_bp.vulnogram', vulnerability_id=vulnerability_id) }}">Edit</a>
    {% endif %}
  </div>
</div>
{%- endmacro %}

{% macro circl_view(source, vulnerability_id, vulnerability_data) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title">{{vulnerability_id}}</h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://www.circl.lu" rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    {%if 'rejectedReasons' in vulnerability_data['containers']['cna']%}
      {%for reason in vulnerability_data['containers']['cna']['rejectedReasons']%}
        <p class="card-text">{{reason['value']}}</p>
      {%endfor%}
      {% if 'replacedBy' in vulnerability_data['containers']['cna']%}
        {% for replaced in  vulnerability_data['containers']['cna']['replacedBy'] %}
        <p class="card-text">
          Replaced by <a href="{{url_for('home_bp.vulnerability_view', vulnerability_id=replaced)}}" class="card-link">{{replaced}}</a>
        </p>
        {%endfor%}
      {%endif%}
    {%else%}
      {% if vulnerability_data['containers']['cna']['title'] %}
        <p class="card-text">{{vulnerability_data['containers']['cna']['title']}}</p>
      {% else %}
        <p class="card-text">{{vulnerability_data['containers']['cna']['descriptions'][0]['value']}}</p>
      {%endif%}
      {%if 'cisa_known_exploited' in vulnerability_data['meta']%}
        {{ cisa_known_exploited_view(vulnerability_data['meta']['cisa_known_exploited']) }}
      {%endif%}
    {%endif%}
    {{ collapse_raw(vulnerability_id, vulnerability_data) }}
    {% if config.user_accounts  %}
      <a class="btn btn-primary" type="button" href="{{ url_for('user_bp.vulnogram', vulnerability_id=vulnerability_id) }}">Edit</a>
    {% endif %}
  </div>
</div>
{%- endmacro %}

{% macro github_view(source, vulnerability_id, vulnerability_data) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title">{{vulnerability_id}}</h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://github.com/advisories" rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    <p class="card-text">{{vulnerability_data['summary']}}</p>
    <p class="card-text">{{vulnerability_data['details']}}</p>
    <a href="https://github.com/advisories/{{vulnerability_id}}" class="card-link" rel="noreferrer" target="_blank">Show details on source website</a>
    {{ collapse_raw(vulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}

{% macro ossf_malicious_packages_view(source, vulnerability_id, vulnerability_data) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title">{{vulnerability_id}}</h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://github.com/ossf/malicious-packages" rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    <p class="card-text">{{vulnerability_data['summary']}}</p>
    <p class="card-text">{{vulnerability_data['details']}}</p>
    {{ collapse_raw(vulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}

{% macro csaf_siemens_view(source, vulnerability_id, vulnerability_data) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title">{{vulnerability_id}}</h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://www.siemens.com/global/en/products/services/cert.html" rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    <p class="card-text">{{vulnerability_data['document']['title']}}</p>
    {% for note in vulnerability_data['document']['notes'] %}
    <p class="card-text">
      {%if 'title' in note%}
        <b>{{note['title']}}</b>:
      {%endif%}
      {{note['text']}}
    </p>
    {% endfor %}
    {{ collapse_raw(vulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}

{% macro csaf_certbund_view(source, vulnerability_id, vulnerability_data) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title">{{vulnerability_id}}</h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://wid.cert-bund.de/portal/wid/start" rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    <p class="card-text">{{vulnerability_data['document']['title']}}</p>
    {% for note in vulnerability_data['document']['notes'] %}
    <p class="card-text">
      {%if 'title' in note%}
        <b>{{note['title']}}</b>:
      {%endif%}
      {{note['text']}}
    </p>
    {% endfor %}
    {{ collapse_raw(vulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}

{% macro csaf_redhat_view(source, vulnerability_id, vulnerability_data) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title">{{vulnerability_id}}</h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://access.redhat.com/security/" rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    <p class="card-text">{{vulnerability_data['document']['title']}}</p>
    {% for note in vulnerability_data['document']['notes'] %}
    <p class="card-text">
      {%if 'title' in note%}
        <b>{{note['title']}}</b>:
      {%endif%}
      {{note['text']}}
    </p>
    {% endfor %}
    {{ collapse_raw(vulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}

{% macro csaf_cisa_view(source, vulnerability_id, vulnerability_data) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title">{{vulnerability_id}}</h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://www.cisa.gov" rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    <p class="card-text">{{vulnerability_data['document']['title']}}</p>
    {% for note in vulnerability_data['document']['notes'] %}
    <p class="card-text">
      {%if 'title' in note%}
        <b>{{note['title']}}</b>:
      {%endif%}
      {{note['text']}}
    </p>
    {% endfor %}
    {{ collapse_raw(vulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}

{% macro csaf_cisco_view(source, vulnerability_id, vulnerability_data) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title">{{vulnerability_id}}</h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://www.cisco.com" rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    <p class="card-text">{{vulnerability_data['document']['title']}}</p>
    {% for note in vulnerability_data['document']['notes'] %}
    <p class="card-text">
      {%if 'title' in note%}
        <b>{{note['title']}}</b>:
      {%endif%}
      {{note['text']}}
    </p>
    {% endfor %}
    {{ collapse_raw(vulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}

{% macro csaf_sick_view(source, vulnerability_id, vulnerability_data) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title">{{vulnerability_id}}</h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://www.sick.com/psirt"  rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    <p class="card-text">{{vulnerability_data['document']['title']}}</p>
    {% for note in vulnerability_data['document']['notes'] %}
    <p class="card-text">
      {%if 'title' in note%}
        <b>{{note['title']}}</b>:
      {%endif%}
      {{note['text']}}
    </p>
    {% endfor %}
    {{ collapse_raw(vulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}

{% macro csaf_ox_view(source, vulnerability_id, vulnerability_data) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title">{{vulnerability_id}}</h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://open-xchange.com" rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    <p class="card-text">{{vulnerability_data['document']['title']}}</p>
    {% for note in vulnerability_data['document']['notes'] %}
    <p class="card-text">
      {%if 'title' in note%}
        <b>{{note['title']}}</b>:
      {%endif%}
      {{note['text']}}
    </p>
    {% endfor %}
    {{ collapse_raw(vulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}

{% macro csaf_nozominetworks_view(source, vulnerability_id, vulnerability_data) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title">{{vulnerability_id}}</h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://security.nozominetworks.com/"  rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    <p class="card-text">{{vulnerability_data['document']['title']}}</p>
    {% for note in vulnerability_data['document']['notes'] %}
    <p class="card-text">
      {%if 'title' in note%}
        <b>{{note['title']}}</b>:
      {%endif%}
      {{note['text']}}
    </p>
    {% endfor %}
    {{ collapse_raw(vulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}

{% macro gsd_view(source, vulnerability_id, vulnerability_data) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title">{{vulnerability_id}}</h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://gsd.id" rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    {{ collapse_raw(vulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}

{% macro pysec_view(source, vulnerability_id, vulnerability_data) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title">{{vulnerability_id}}</h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://github.com/pypa/advisory-database" rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    <p class="card-text">{{vulnerability_data['details']}}</p>
    {{ collapse_raw(vulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}

{% macro variot_view(source, vulnerability_id, vulnerability_data) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title">{{vulnerability_id}}</h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://www.variotdbs.pl/vulns/"  rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    <p class="card-text">{{vulnerability_data['description']['data']}}</p>
    <a href="https://www.variotdbs.pl/vuln/{{vulnerability_id}}" class="card-link"  rel="noreferrer" target="_blank">Show details on source website</a>
    {{ collapse_raw(vulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}
