#!/usr/bin/env python3

import click

import website.models
import website.scripts
from website.web.bootstrap import application, db


@application.cli.command("db_init")
def db_init() -> None:
    "Will create the database from conf parameters."
    with application.app_context():
        website.models.db_init(db)


@application.cli.command("create_user")
@click.option("--login", default="admin", help="Login")
@click.option("--email", default="admin@admin.localhost", help="Email")
@click.option("--password", default="password", help="Password")
def create_user(login: str, email: str, password: str) -> None:
    "Initializes a user"
    print(f"Creation of the user {login}…")
    with application.app_context():
        website.scripts.create_user(login, email, password, True, False)


@application.cli.command("create_admin")
@click.option("--login", default="admin", help="Login")
@click.option("--email", default="admin@admin.localhost", help="Email")
@click.option("--password", default="password", help="Password")
def create_admin(login: str, email: str, password: str) -> None:
    "Initializes an admin user"
    print(f"Creation of the admin user {login}…")
    with application.app_context():
        website.scripts.create_user(login, email, password, True, True)
