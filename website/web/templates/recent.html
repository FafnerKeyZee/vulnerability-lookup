{% extends "main.html" %}
{% from 'bootstrap5/utils.html' import render_messages %}
{% import 'vulnerability_templates.html' as vuln_templates %}

{% block title %}Recent vulnerabilities{% endblock %}

{%block navbar_links%}
<li class="nav-item">
  <a class="nav-link" href="{{url_for('search')}}">Search</a>
</li>
<li class="nav-item">
  <a class="nav-link active" href="{{url_for('recent')}}">Recent</a>
</li>
{% endblock%}

{% block content %}
<h1>Most recent vulnerabilities by source</h1>
<h6>The vulnerabilities are sorted by update time (recent ot old)</h6>
<ul class="nav nav-tabs" id="vulnSourcesTab" role="tablist">
  {% for source in recent.keys() %}
  <li class="nav-item" role="presentation">
      <button class="nav-link {% if source == "nvd" %}active{%endif%}" id="{{source}}-tab"
                                      data-bs-toggle="tab"
                                      data-bs-target="#{{source}}-tab-pane"
                                      type="button" role="tab"
                                      aria-controls="{{source}}-tab-pane"
                                      aria-selected="true">
		{{source}}
	  </button>
  </li>
  {%endfor%}
</ul>
<div class="tab-content" id="vulnSourcesTabContent">
  {% for source, vulns in recent.items() %}
  <div class="tab-pane fade show {% if source == 'nvd' %} active {%endif%}"
       id="{{source}}-tab-pane" role="tabpanel" aria-labelledby="{{source}}-tab" tabindex="0">
	<table class="table">
	  {% if source in ['nvd', 'gad'] %}
	  <thead>
		<tr>
		  <th scope="col">Vulnerability ID</th>
		  <th scope="col">Description</th>
		</tr>
	  </thead>
	  {%endif%}
	  <tbody>
	  {%for vuln in vulns %}
		{% if source == "nvd"%}
		<tr>
		  <th scope="row"><a href="https://nvd.nist.gov/vuln/detail/{{vuln['cve']['id']}}">
			{{vuln['cve']['id']}}</a>
		  </th>
		  <td>{{vuln['cve']['descriptions'][0]['value']}}</td>
		</tr>
		{%elif source == "gad" %}
		<tr>
		  <th scope="row">
			<a href="https://github.com/advisories/{{vuln['id']}}">{{vuln['id']}}</a>
		  </th>
		  <td>{{vuln['details']}}</td>
		</tr>
		{%else%}
		<tr>
		  <td colspan="1">
			<pre>{{vuln|tojson(indent=2)}}</pre>
		  </td>
		</tr>
		{%endif%}
	  {%endfor%}
	  </tbody>
	</table>
  </div>
  {%endfor%}
</div>


{% endblock %}
